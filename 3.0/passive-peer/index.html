
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Kotlin Multiplatform library for Couchbase Lite—a lightweight, embedded, syncable, NoSQL database">
      
      
        <meta name="author" content="Jeff Lockhart">
      
      
        <link rel="canonical" href="https://kotbase.dev/current/passive-peer/">
      
      
        <link rel="prev" href="../peer-to-peer-sync/">
      
      
        <link rel="next" href="../active-peer/">
      
      
      <link rel="icon" href="../assets/images/couchbase-logo.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Passive Peer - Kotbase</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--link:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg>');--md-admonition-icon--important:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 6a6 6 0 0 1 6 6c0 2.22-1.21 4.16-3 5.2V19a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-1.8c-1.79-1.04-3-2.98-3-5.2a6 6 0 0 1 6-6m2 15v1a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-1h4m6-10h3v2h-3v-2M1 11h3v2H1v-2M13 1v3h-2V1h2M4.92 3.5l2.13 2.14-1.42 1.41L3.5 4.93 4.92 3.5m12.03 2.13 2.12-2.13 1.43 1.43-2.13 2.12-1.42-1.42Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DM+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"DM Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/permalink.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-QFS8SG5ZKD"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-QFS8SG5ZKD",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-QFS8SG5ZKD",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kotbase" class="md-header__button md-logo" aria-label="Kotbase" data-md-component="logo">
      
  <img src="../assets/images/couchbase-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kotbase
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Passive Peer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jeffdgr8/kotbase" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kotbase
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../installation/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../databases/" class="md-tabs__link">
          
  
  Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../api" target="_blank" class="md-tabs__link">
        
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kotbase" class="md-nav__button md-logo" aria-label="Kotbase" data-md-component="logo">
      
  <img src="../assets/images/couchbase-logo.svg" alt="logo">

    </a>
    Kotbase
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jeffdgr8/kotbase" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kotbase
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Overview
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kotbase
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../differences/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Differences from Java SDK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change Log
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../platforms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supported Platforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build and Run
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Extension Libraries
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Extension Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ktx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KTX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kermit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kermit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Paging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prebuilt-database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre-built Database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Query
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Query
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query-builder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QueryBuilder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../n1ql-query-strings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL++ Query Strings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../n1ql-server-differences/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL++ Server Differences
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../n1ql-query-builder-differences/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL++ QueryBuilder Differences
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query-result-sets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Result Sets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../live-queries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Live Queries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query-troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../full-text-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Full Text Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../indexing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Indexing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" checked>
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Sync
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Data Sync
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../remote-sync-gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Sync Gateway
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intra-device-sync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intra-device Sync
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_8_3" id="__nav_3_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Peer-to-Peer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_8_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_8_3">
            <span class="md-nav__icon md-icon"></span>
            Peer-to-Peer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../peer-to-peer-sync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Peer-to-Peer Sync
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Passive Peer
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Passive Peer
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#device-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      Device Discovery
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialize-the-listener-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Initialize the Listener Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-port-and-network-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Set Port and Network Interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Set Port and Network Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-number" class="md-nav__link">
    <span class="md-ellipsis">
      Port number
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Network Interface
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delta-sync" class="md-nav__link">
    <span class="md-ellipsis">
      Delta Sync
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-security" class="md-nav__link">
    <span class="md-ellipsis">
      TLS Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TLS Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-or-disable-tls" class="md-nav__link">
    <span class="md-ellipsis">
      Enable or Disable TLS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-tls-identity-for-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Configure TLS Identity for Listener
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authenticating-the-client" class="md-nav__link">
    <span class="md-ellipsis">
      Authenticating the Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authenticating the Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-basic-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Use Basic Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-client-certificate-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Using Client Certificate Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-entry" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Entry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-impact-of-tls-settings" class="md-nav__link">
    <span class="md-ellipsis">
      The Impact of TLS Settings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Start Listener
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitor-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor Listener
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stop-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Stop Listener
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../active-peer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Peer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrate-custom-listener/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate Custom Listener
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../handling-data-conflicts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Handling Data Conflicts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../using-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Logs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin-extensions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kotlin Extensions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#device-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      Device Discovery
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialize-the-listener-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Initialize the Listener Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-port-and-network-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Set Port and Network Interface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Set Port and Network Interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-number" class="md-nav__link">
    <span class="md-ellipsis">
      Port number
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Network Interface
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delta-sync" class="md-nav__link">
    <span class="md-ellipsis">
      Delta Sync
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tls-security" class="md-nav__link">
    <span class="md-ellipsis">
      TLS Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TLS Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-or-disable-tls" class="md-nav__link">
    <span class="md-ellipsis">
      Enable or Disable TLS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-tls-identity-for-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Configure TLS Identity for Listener
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authenticating-the-client" class="md-nav__link">
    <span class="md-ellipsis">
      Authenticating the Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authenticating the Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-basic-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Use Basic Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-client-certificate-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Using Client Certificate Authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-entry" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Entry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-impact-of-tls-settings" class="md-nav__link">
    <span class="md-ellipsis">
      The Impact of TLS Settings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Start Listener
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitor-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor Listener
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stop-listener" class="md-nav__link">
    <span class="md-ellipsis">
      Stop Listener
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Passive Peer</h1>

<p><em>How to set up a listener to accept a replicator connection and sync using peer-to-peer</em></p>
<div class="admonition warning">
<p class="admonition-title">Android enablers</p>
<p><strong>Allow Unencrypted Network Traffic</strong></p>
<p>To use cleartext, un-encrypted, network traffic (<code>http://</code> and-or <code>ws://</code>), include
<code>android:usesCleartextTraffic="true"</code> in the <code>application</code> element of the manifest as shown on
<a href="https://developer.android.com/training/articles/security-config#CleartextTrafficPermitted">developer.android.com</a>.<br />
<strong>This not recommended in production.</strong></p>
</div>
<div class="admonition warning">
<p class="admonition-title">iOS Restrictions</p>
<p><strong>iOS 14 Applications</strong></p>
<p>When your application attempts to access the user’s local network, iOS will prompt them to allow (or deny) access.
You can customize the message presented to the user by editing the description for the
<code>NSLocalNetworkUsageDescription</code> key in the <code>Info.plist</code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Use Background Threads</p>
<p>As with any network or file I/O activity, Couchbase Lite activities should not be performed on the UI thread.
<strong>Always</strong> use a <strong>background</strong> thread.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Code Snippets</p>
<p>All code examples are indicative only. They demonstrate the basic concepts and approaches to using a feature. Use
them as inspiration and adapt these examples to best practice when developing applications for your platform.</p>
</div>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link"></a></h2>
<div class="admonition important">
<p class="admonition-title">This is an <a href="https://www.couchbase.com/products/editions">Enterprise Edition</a> feature.</p>
</div>
<p>This content provides code and configuration examples covering the implementation of <a href="https://docs.couchbase.com/couchbase-lite/current/android/refer-glossary.html#peer-to-peer-sync">Peer-to-Peer Sync</a> over WebSockets.
Specifically, it covers the implementation of a <a href="https://docs.couchbase.com/couchbase-lite/current/android/refer-glossary.html#passive-peer">Passive Peer</a>.</p>
<p>Couchbase’s Passive Peer (also referred to as the server, or listener) will accept a connection from an <a href="https://docs.couchbase.com/couchbase-lite/current/android/refer-glossary.html#active-peer">Active Peer</a> (also referred to as the
client or replicator) and replicate database changes to synchronize both databases.</p>
<p>Subsequent sections provide additional details and examples for the main configuration options.</p>
<div class="admonition note">
<p class="admonition-title">Secure Storage</p>
<p>The use of TLS, its associated keys and certificates requires using secure storage to minimize the chances of a
security breach. The implementation of this storage differs from platform to platform — see <a href="../peer-to-peer-sync/#using-secure-storage">Using Secure Storage</a>.</p>
</div>
<h2 id="configuration-summary">Configuration Summary<a class="headerlink" href="#configuration-summary" title="Permanent link"></a></h2>
<p>You should configure and initialize a listener for each Couchbase Lite database instance you want to sync. There is no
limit on the number of listeners you may configure — <a href="#example-1">Example 1</a> shows a simple initialization and
configuration process.</p>
<div class="admonition example">
<p class="admonition-title"><span id='example-1'>Example 1. Listener configuration and initialization</span></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URLEndpointListener</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="n">URLEndpointListenerConfigurationFactory</span><span class="p">.</span><span class="na">newConfig</span><span class="p">(</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">        </span><span class="n">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">database</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">55990</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">        </span><span class="n">networkInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wlan0&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="n">enableDeltaSync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">        </span><span class="c1">// Configure server security</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">        </span><span class="n">disableTls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="c1">// Use an Anonymous Self-Signed Cert</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">        </span><span class="n">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">        </span><span class="c1">// Configure Client Security using an Authenticator</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">        </span><span class="c1">// For example, Basic Authentication</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">        </span><span class="n">authenticator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListenerPasswordAuthenticator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">usr</span><span class="p">,</span><span class="w"> </span><span class="n">pwd</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">            </span><span class="p">(</span><span class="n">usr</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">validUser</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pwd</span><span class="p">.</span><span class="na">concatToString</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">validPass</span><span class="p">)</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="c1">// Start the listener</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="n">listener</span><span class="p">.</span><span class="na">start</span><span class="p">()</span>
</span></code></pre></div>
</div>
<ol>
<li>Identify the local database to be used — see <a href="#initialize-the-listener-configuration">Initialize the Listener Configuration
   </a></li>
<li>Optionally, choose a port to use. By default, the system will automatically assign a port — to override this, see
   <a href="#set-port-and-network-interface">Set Port and Network Interface</a></li>
<li>Optionally, choose a network interface to use. By default, the system will listen on all network interfaces — to
   override this see <a href="#set-port-and-network-interface">Set Port and Network Interface</a></li>
<li>Optionally, choose to sync only changes. The default is not to enable delta-sync — see <a href="#delta-sync">Delta Sync</a></li>
<li>Set server security. TLS is always enabled instantly, so you can usually omit this line. But you <em>can</em>, optionally,
   disable TLS (<strong>not</strong> advisable in production) — see <a href="#tls-security">TLS Security</a></li>
<li>Set the credentials this server will present to the client for authentication. Here we show the default TLS
   authentication, which is an anonymous self-signed certificate. The server must always authenticate itself to the
   client.</li>
<li>Set client security — define the credentials the server expects the client to present for authentication. Here we
   show how basic authentication is configured to authenticate the client-supplied credentials from the http
   authentication header against valid credentials — see <a href="#authenticating-the-client">Authenticating the Client</a> for
   more options.<br />
   Note that client authentication is optional.</li>
<li>Initialize the listener using the configuration settings.</li>
<li><a href="#start-listener">Start Listener</a></li>
</ol>
<h2 id="device-discovery">Device Discovery<a class="headerlink" href="#device-discovery" title="Permanent link"></a></h2>
<p><strong>This phase is optional:</strong> If the listener is initialized on a well-known URL endpoint (for example, a static IP
address or well-known DNS address) then you can configure Active Peers to connect to those.</p>
<p>Before initiating the listener, you may execute a peer discovery phase. For the Passive Peer, this involves advertising
the service using, for example, <a href="https://developer.android.com/training/connect-devices-wirelessly/nsd">Network Service Discovery on Android</a> or <a href="https://developer.apple.com/bonjour/">Bonjour on iOS</a> and waiting for an invite from the Active Peer. The connection is established once
the Passive Peer has authenticated and accepted an Active Peer’s invitation.</p>
<h2 id="initialize-the-listener-configuration">Initialize the Listener Configuration<a class="headerlink" href="#initialize-the-listener-configuration" title="Permanent link"></a></h2>
<p>Initialize the listener configuration with the local database — see <a href="#example-2">Example 2</a>. All other configuration
values take their default setting.</p>
<p>Each listener instance serves one Couchbase Lite database. Couchbase sets no hard limit on the number of listeners you
can initialize.</p>
<div class="admonition example">
<p class="admonition-title"><span id='example-2'>Example 2. Specify Local Database</span></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">database</span><span class="p">,</span>
</span></code></pre></div>
</div>
<p>Set the local database using the <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/"><code>URLEndpointListenerConfiguration</code></a>'s constructor
<a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/-u-r-l-endpoint-listener-configuration.html"><code>URLEndpointListenerConfiguration(Database)</code></a>.<br />
The database must be opened before the listener is started.  </p>
<h2 id="set-port-and-network-interface">Set Port and Network Interface<a class="headerlink" href="#set-port-and-network-interface" title="Permanent link"></a></h2>
<h3 id="port-number">Port number<a class="headerlink" href="#port-number" title="Permanent link"></a></h3>
<p>The Listener will automatically select an available port if you do not specify one — see <a href="#example-3">Example 3</a> for how
to specify a port.</p>
<div class="admonition example">
<p class="admonition-title"><span id='example-3'>Example 3. Specify a port</span></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">55990</span><span class="p">,</span>
</span></code></pre></div>
</div>
<p>To use a canonical port — one known to other applications — specify it explicitly using the <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/port.html"><code>port</code></a> property shown here.<br />
Ensure that firewall rules do not block any port you do specify.</p>
<h3 id="network-interface">Network Interface<a class="headerlink" href="#network-interface" title="Permanent link"></a></h3>
<p>The listener will listen on all network interfaces by default.</p>
<div class="admonition example">
<p class="admonition-title">Example 4. Specify a Network Interface to Use</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">networkInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wlan0&quot;</span><span class="p">,</span>
</span></code></pre></div>
</div>
<p>To specify an interface — one known to other applications — identify it explicitly, using the <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/network-interface.html"><code>networkInterface</code></a> property shown here. This
must be either an IP address or network interface name such as <code>en0</code>.</p>
<h2 id="delta-sync">Delta Sync<a class="headerlink" href="#delta-sync" title="Permanent link"></a></h2>
<p>Delta Sync allows clients to sync only those parts of a document that have changed. This can result in significant
bandwidth consumption savings and throughput improvements. Both are valuable benefits, especially when network bandwidth
is constrained.</p>
<div class="admonition example">
<p class="admonition-title">Example 5. Enable delta sync</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">enableDeltaSync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span></code></pre></div>
</div>
<p>Delta sync replication is not enabled by default. Use <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/"><code>URLEndpointListenerConfiguration</code></a>'s <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/is-delta-sync-enabled.html"><code>isDeltaSyncEnabled</code></a> property to activate
or deactivate it.</p>
<h2 id="tls-security">TLS Security<a class="headerlink" href="#tls-security" title="Permanent link"></a></h2>
<h3 id="enable-or-disable-tls">Enable or Disable TLS<a class="headerlink" href="#enable-or-disable-tls" title="Permanent link"></a></h3>
<p>Define whether the connection is to use TLS or clear text.</p>
<p>TLS-based encryption is enabled by default, and this setting ought to be used in any production environment. However, it
<em>can</em> be disabled. For example, for development or test environments.</p>
<p>When TLS is enabled, Couchbase Lite provides several options on how the listener may be configured with an appropriate
TLS Identity — see <a href="#configure-tls-identity-for-listener">Configure TLS Identity for Listener</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On the Android platform, to use cleartext, un-encrypted, network traffic (<code>http://</code> and-or <code>ws://</code>), include
<code>android:usesCleartextTraffic="true"</code> in the <code>application</code> element of the manifest as shown on
<a href="https://developer.android.com/training/articles/security-config#CleartextTrafficPermitted">developer.android.com</a>.<br />
<strong>This not recommended in production.</strong></p>
</div>
<p>You can use <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/"><code>URLEndpointListenerConfiguration</code></a>'s <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/is-tls-disabled.html"><code>isTlsDisabled</code></a> method to disable TLS
communication if necessary.</p>
<p>The <code>isTlsDisabled</code> setting must be <code>false</code> when <em>Client Cert Authentication</em> is required.</p>
<p>Basic Authentication can be used with, or without, TLS.</p>
<p><code>isTlsDisabled</code> works in conjunction with <code>TLSIdentity</code>, to enable developers to define the key and certificate to be
used.</p>
<ul>
<li>If <code>isTlsDisabled</code> is <code>true</code> — TLS communication is disabled and TLS identity is ignored.<br />
  Active peers will use the <code>ws://</code> URL scheme used to connect to the listener.</li>
<li>If <code>isTlsDisabled</code> is <code>false</code> or not specified — TLS communication is enabled.<br />
  Active peers will use the wss:// URL scheme to connect to the listener.</li>
</ul>
<h3 id="configure-tls-identity-for-listener">Configure TLS Identity for Listener<a class="headerlink" href="#configure-tls-identity-for-listener" title="Permanent link"></a></h3>
<p>Define the credentials the server will present to the client for authentication. Note that the server must always
authenticate itself with the client — see <a href="../active-peer/#authenticating-the-listener">Authenticating the Listener on Active Peer</a> for how the client deals with this.</p>
<p>Use <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/"><code>URLEndpointListenerConfiguration</code></a>'s
<a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/tls-identity.html"><code>tlsIdentity</code></a> property to
configure the TLS Identity used in TLS communication.</p>
<p>If <a href="/api/couchbase-lite-ee/kotbase/-t-l-s-identity/"><code>TLSIdentity</code></a> is not set, then the listener uses an auto-generated
anonymous self-signed identity (unless <code>isTlsDisabled = true</code>). Whilst the client cannot use this to authenticate the
server, it will use it to encrypt communication, giving a more secure option than non-TLS communication.</p>
<p>The auto-generated anonymous self-signed identity is saved in secure storage for future use to obviate the need to
re-generate it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Typically, you will configure the listener’s TLS Identity once during the initial launch and re-use it (from secure
storage on any subsequent starts.</p>
</div>
<p>Here are some example code snippets showing:</p>
<ul>
<li>Importing a TLS identity — see <a href="#example-6">Example 6</a></li>
<li>Setting TLS identity to expect self-signed certificate — see <a href="#example-7">Example 7</a></li>
<li>Setting TLS identity to expect anonymous certificate — see <a href="#example-8">Example 8</a></li>
</ul>
<div class="admonition example">
<p class="admonition-title"><span id='example-6'>Example 6. Import Listener’s TLS identity</span></p>
<p>TLS identity certificate import APIs are platform-specific.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Android</label><label for="__tabbed_1_2">iOS/macOS</label><label for="__tabbed_1_3">JVM</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-kotlin highlight"><span class="filename">in androidMain</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">config</span><span class="p">.</span><span class="na">isTlsDisabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">KeyStoreUtils</span><span class="p">.</span><span class="na">importEntry</span><span class="p">(</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="s">&quot;PKCS12&quot;</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="n">context</span><span class="p">.</span><span class="na">assets</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="s">&quot;cert.p12&quot;</span><span class="p">),</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="s">&quot;store-password&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">(),</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="s">&quot;store-alias&quot;</span><span class="p">,</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="s">&quot;key-password&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">(),</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="s">&quot;new-alias&quot;</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="n">config</span><span class="p">.</span><span class="na">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">getIdentity</span><span class="p">(</span><span class="s">&quot;new-alias&quot;</span><span class="p">)</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><span class="filename">in appleMain</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">config</span><span class="p">.</span><span class="na">isTlsDisabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSBundle</span><span class="p">.</span><span class="na">mainBundle</span><span class="p">.</span><span class="na">pathForResource</span><span class="p">(</span><span class="s">&quot;cert&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ofType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;p12&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kd">val</span><span class="w"> </span><span class="nv">certData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSData</span><span class="p">.</span><span class="na">dataWithContentsOfFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="kd">val</span><span class="w"> </span><span class="nv">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">importIdentity</span><span class="p">(</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">certData</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">(),</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">(),</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="n">alias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;alias&quot;</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="p">)</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="n">config</span><span class="p">.</span><span class="na">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tlsIdentity</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><span class="filename">in jvmMain</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">config</span><span class="p">.</span><span class="na">isTlsDisabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kd">val</span><span class="w"> </span><span class="nv">keyStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyStore</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;PKCS12&quot;</span><span class="p">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">Files</span><span class="p">.</span><span class="na">newInputStream</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s">&quot;cert.p12&quot;</span><span class="p">)).</span><span class="na">use</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">keyStream</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="n">keyStore</span><span class="p">.</span><span class="na">load</span><span class="p">(</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="n">keyStream</span><span class="p">,</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">        </span><span class="s">&quot;keystore-password&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">()</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="p">}</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">config</span><span class="p">.</span><span class="na">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">getIdentity</span><span class="p">(</span><span class="n">keyStore</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;alias&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;keyPass&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">())</span>
</span></code></pre></div>
</div>
</div>
</div>
</div>
<ol>
<li>Ensure TLS is used</li>
<li>Get key and certificate data</li>
<li>Use the retrieved data to create and store the TLS identity</li>
<li>Set this identity as the one presented in response to the client’s prompt</li>
</ol>
<div class="admonition example">
<p class="admonition-title"><span id='example-7'>Example 7. Create Self-Signed Cert</span></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Common</label><label for="__tabbed_2_2">JVM</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-kotlin highlight"><span class="filename">in commonMain</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">config</span><span class="p">.</span><span class="na">isTlsDisabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kd">val</span><span class="w"> </span><span class="nv">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapOf</span><span class="p">(</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">CERT_ATTRIBUTE_COMMON_NAME</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;Couchbase Demo&quot;</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">CERT_ATTRIBUTE_ORGANIZATION</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;Couchbase&quot;</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">CERT_ATTRIBUTE_ORGANIZATION_UNIT</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;Mobile&quot;</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">CERT_ATTRIBUTE_EMAIL_ADDRESS</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s">&quot;noreply@couchbase.com&quot;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="p">)</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="kd">val</span><span class="w"> </span><span class="nv">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">createIdentity</span><span class="p">(</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="n">attrs</span><span class="p">,</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">    </span><span class="n">Clock</span><span class="p">.</span><span class="na">System</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1.</span><span class="n">days</span><span class="p">,</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="s">&quot;cert-alias&quot;</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="p">)</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="n">config</span><span class="p">.</span><span class="na">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tlsIdentity</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-kotlin highlight"><span class="filename">in jvmMain</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">// On the JVM platform, before calling</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="c1">// common TLSIdentity.createIdentity() or getIdentity()</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="c1">// load a KeyStore to use</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kd">val</span><span class="w"> </span><span class="nv">keyStore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyStore</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;PKCS12&quot;</span><span class="p">)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">keyStore</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">useKeyStore</span><span class="p">(</span><span class="n">keyStore</span><span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
</div>
<ol>
<li>Ensure TLS is used.</li>
<li>Map the required certificate attributes.</li>
<li>Create the required TLS identity using the attributes. Add to secure storage as 'cert-alias'.</li>
<li>Configure the server to present the defined identity credentials when prompted.</li>
</ol>
<div class="admonition example">
<p class="admonition-title"><span id='example-8'>Example 8. Use Anonymous Self-Signed Certificate</span></p>
<p>This example uses an <em>anonymous</em> self-signed certificate. Generated certificates are held in secure storage.</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">config</span><span class="p">.</span><span class="na">isTlsDisabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1">// Use an Anonymous Self-Signed Cert</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">config</span><span class="p">.</span><span class="na">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
</span></code></pre></div>
</div>
<ol>
<li>Ensure TLS is used.<br />
   This is the default setting.</li>
<li>Authenticate using an anonymous self-signed certificate.<br />
   This is the default setting.</li>
</ol>
<h2 id="authenticating-the-client">Authenticating the Client<a class="headerlink" href="#authenticating-the-client" title="Permanent link"></a></h2>
<p><strong>In this section</strong><br />
<a href="#use-basic-authentication">Use Basic Authentication</a> | <a href="#using-client-certificate-authentication">Using Client Certificate Authentication
</a> | <a href="#delete-entry">Delete Entry</a> | <a href="#the-impact-of-tls-settings">The Impact of TLS Settings
</a></p>
<p>Define how the server (listener) will authenticate the client as one it is prepared to interact with.</p>
<p>Whilst client authentication is optional, Couchbase Lite provides the necessary tools to implement it. Use the
<a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/"><code>URLEndpointListenerConfiguration</code></a> class’s
<a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener-configuration/authenticator.html"><code>authenticator</code></a> property to
specify how the client-supplied credentials are to be authenticated.</p>
<p>Valid options are:</p>
<ul>
<li>No authentication — If you do not define a <code>ListenerAuthenticator</code> then all clients are accepted.</li>
<li>Basic Authentication — uses the <a href="/api/couchbase-lite-ee/kotbase/-listener-password-authenticator/"><code>ListenerPasswordAuthenticator</code></a> to authenticate the client using the client-supplied
  username and password (from the http authentication header).</li>
<li><a href="/api/couchbase-lite-ee/kotbase/-listener-certificate-authenticator/"><code>ListenerCertificateAuthenticator</code></a> — which
  authenticates the client using a client supplied chain of one or more certificates. You should initialize the
  authenticator using one of the following constructors:<ul>
<li>A list of one or more root certificates — the client supplied certificate must end at a certificate in this list
  if it is to be authenticated</li>
<li>A block of code that assumes total responsibility for authentication — it must return a boolean response (<code>true</code>
  for an authenticated client, or <code>false</code> for a failed authentication).</li>
</ul>
</li>
</ul>
<h3 id="use-basic-authentication">Use Basic Authentication<a class="headerlink" href="#use-basic-authentication" title="Permanent link"></a></h3>
<p>Define how to authenticate client-supplied username and password credentials. To use client-supplied certificates
instead — see <a href="#using-client-certificate-authentication">Using Client Certificate Authentication</a></p>
<div class="admonition example">
<p class="admonition-title">Example 9. Password authentication</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">config</span><span class="p">.</span><span class="na">authenticator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListenerPasswordAuthenticator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">validUser</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="na">concatToString</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">validPassword</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<p>Where <code>username</code>/<code>password</code> are the client-supplied values (from the http-authentication header) and
<code>validUser</code>/<code>validPassword</code> are the values acceptable to the server.</p>
<h3 id="using-client-certificate-authentication">Using Client Certificate Authentication<a class="headerlink" href="#using-client-certificate-authentication" title="Permanent link"></a></h3>
<p>Define how the server will authenticate client-supplied certificates.</p>
<p>There are two ways to authenticate a client:</p>
<ul>
<li>A chain of one or more certificates that ends at a certificate in the list of certificates supplied to the constructor
  for <a href="/api/couchbase-lite-ee/kotbase/-listener-certificate-authenticator/"><code>ListenerCertificateAuthenticator</code></a> — see
  <a href="#example-10">Example 10</a></li>
<li>Application logic: This method assumes complete responsibility for verifying and authenticating the client — see
  <a href="#example-11">Example 11</a><br><br>
  If the parameter supplied to the constructor for <code>ListenerCertificateAuthenticator</code> is of type
  <code>ListenerCertificateAuthenticatorDelegate</code>, all other forms of authentication are bypassed.<br><br>
  The client response to the certificate request is passed to the method supplied as the constructor parameter. The
  logic should take the form of a function or lambda.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example 10. Set Certificate Authorization</p>
<p>Configure the server (listener) to authenticate the client against a list of one or more certificates provided by
the server to the <a href="/api/couchbase-lite-ee/kotbase/-listener-certificate-authenticator/"><code>ListenerCertificateAuthenticator</code></a>.</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">// Configure the client authenticator</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="c1">// to validate using ROOT CA</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="c1">// validId.certs is a list containing a client cert to accept</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1">// and any other certs needed to complete a chain between</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1">// the client cert and a CA</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="kd">val</span><span class="w"> </span><span class="nv">validId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">getIdentity</span><span class="p">(</span><span class="s">&quot;Our Corporate Id&quot;</span><span class="p">)</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Cannot find corporate id&quot;</span><span class="p">)</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="c1">// accept only clients signed by the corp cert</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="kd">val</span><span class="w"> </span><span class="nv">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URLEndpointListener</span><span class="p">(</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="n">URLEndpointListenerConfigurationFactory</span><span class="p">.</span><span class="na">newConfig</span><span class="p">(</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">        </span><span class="c1">// get the identity </span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">        </span><span class="n">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">database</span><span class="p">,</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">        </span><span class="n">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validId</span><span class="p">,</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">        </span><span class="n">authenticator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListenerCertificateAuthenticator</span><span class="p">(</span><span class="n">validId</span><span class="p">.</span><span class="na">certs</span><span class="p">)</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="p">)</span>
</span></code></pre></div>
</div>
<ol>
<li>Get the identity data to authenticate against. This can be, for example, from a resource file provided with the app,
   or an identity previously saved in secure storage.</li>
<li>Configure the authenticator to authenticate the client supplied certificate(s) using these root certs. A valid client
   will provide one or more certificates that match a certificate in this list.</li>
<li>Add the authenticator to the listener configuration.</li>
</ol>
<div class="admonition example">
<p class="admonition-title">Example 11. Application Logic</p>
<p>Configure the server (listener) to authenticate the client using user-supplied logic.</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// Configure authentication using application logic</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">corpId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">getIdentity</span><span class="p">(</span><span class="s">&quot;OurCorp&quot;</span><span class="p">)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="o">?:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;Cannot find corporate id&quot;</span><span class="p">)</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">config</span><span class="p">.</span><span class="na">tlsIdentity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">corpId</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">config</span><span class="p">.</span><span class="na">authenticator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListenerCertificateAuthenticator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">certs</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="c1">// supply logic that returns boolean</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="c1">// true for authenticate, false if not</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="c1">// For instance:</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="n">certs</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="p">.</span><span class="na">contentEquals</span><span class="p">(</span><span class="n">corpId</span><span class="p">.</span><span class="na">certs</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="p">)</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<ol>
<li>Get the identity data to authenticate against. This can be, for example, from a resource file provided with the app,
   or an identity previously saved in secure storage.</li>
<li>Configure the authenticator to pass the root certificates to a user supplied code block. This code assumes complete
   responsibility for authenticating the client supplied certificate(s). It must return a boolean value; with <code>true</code>
   denoting the client supplied certificate authentic.</li>
<li>Add the authenticator to the listener configuration.</li>
</ol>
<h3 id="delete-entry">Delete Entry<a class="headerlink" href="#delete-entry" title="Permanent link"></a></h3>
<p>You can remove unwanted TLS identities from secure storage using the convenience API.</p>
<div class="admonition example">
<p class="admonition-title">Example 12. Deleting TLS Identities</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">TLSIdentity</span><span class="p">.</span><span class="na">deleteIdentity</span><span class="p">(</span><span class="s">&quot;cert-alias&quot;</span><span class="p">)</span>
</span></code></pre></div>
</div>
<h3 id="the-impact-of-tls-settings">The Impact of TLS Settings<a class="headerlink" href="#the-impact-of-tls-settings" title="Permanent link"></a></h3>
<p>The table in this section shows the expected system behavior (in regards to security) depending on the TLS configuration settings deployed.</p>
<p><strong>Table 1. Expected system behavior</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">isTlsDisabled</th>
<th style="text-align: left;">tlsIdentity (corresponding to server)</th>
<th style="text-align: left;">Expected system behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>true</code></td>
<td style="text-align: left;">Ignored</td>
<td style="text-align: left;">TLS is disabled; all communication is plain text.</td>
</tr>
<tr>
<td style="text-align: left;"><code>false</code></td>
<td style="text-align: left;">Set to <code>null</code></td>
<td style="text-align: left;"><ul><li>The system will auto generate an <em>anonymous</em> self-signed cert.</li><li>Active Peers (clients) should be configured to accept self-signed certificates.</li><li>Communication is encrypted.</li></ul></td>
</tr>
<tr>
<td style="text-align: left;"><code>false</code></td>
<td style="text-align: left;">Set to server identity generated from a self- or CA-signed certificate<ul><li>On first use — Bring your own certificate and private key; for example, using the <a href="/api/couchbase-lite-ee/kotbase/-t-l-s-identity/"><code>TLSIdentity</code></a> class’s <a href="/api/couchbase-lite-ee/kotbase/-t-l-s-identity/-companion/create-identity.html"><code>createIdentity()</code></a> method to add it to the secure storage.</li><li>Each time — Use the server identity from the certificate stored in the secure storage; for example, using the <a href="/api/couchbase-lite-ee/kotbase/-t-l-s-identity/"><code>TLSIdentity</code></a> class’s <a href="/api/couchbase-lite-ee/kotbase/-t-l-s-identity/-companion/get-identity.html"><code>getIdentity()</code></a> method with the alias you want to retrieve.</li></ul></td>
<td style="text-align: left;"><ul><li>System will use the configured identity.</li><li>Active Peers will validate the server certificate corresponding to the <code>TLSIdentity</code> (as long as they are configured to not skip validation — see <a href="#tls-security">TLS Security</a>).</li></ul></td>
</tr>
</tbody>
</table>
<h2 id="start-listener">Start Listener<a class="headerlink" href="#start-listener" title="Permanent link"></a></h2>
<p>Once you have completed the listener’s configuration settings you can initialize the listener instance and start it
running — see <a href="#example-13">Example 13</a>.</p>
<div class="admonition example">
<p class="admonition-title"><span id='example-13'>Example 13. Initialize and start listener</span></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// Initialize the listener</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URLEndpointListener</span><span class="p">(</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="n">URLEndpointListenerConfigurationFactory</span><span class="p">.</span><span class="na">newConfig</span><span class="p">(</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">        </span><span class="n">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">database</span><span class="p">,</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">        </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">55990</span><span class="p">,</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">        </span><span class="n">networkInterface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;wlan0&quot;</span><span class="p">,</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">        </span><span class="n">enableDeltaSync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">        </span><span class="c1">// Configure server security</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">        </span><span class="n">disableTls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">        </span><span class="c1">// Use an Anonymous Self-Signed Cert</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">        </span><span class="n">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">        </span><span class="c1">// Configure Client Security using an Authenticator</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">        </span><span class="c1">// For example, Basic Authentication</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">        </span><span class="n">authenticator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListenerPasswordAuthenticator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">usr</span><span class="p">,</span><span class="w"> </span><span class="n">pwd</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">            </span><span class="p">(</span><span class="n">usr</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">validUser</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">pwd</span><span class="p">.</span><span class="na">concatToString</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">validPass</span><span class="p">)</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="p">)</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="c1">// Start the listener</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="n">listener</span><span class="p">.</span><span class="na">start</span><span class="p">()</span>
</span></code></pre></div>
</div>
<h2 id="monitor-listener">Monitor Listener<a class="headerlink" href="#monitor-listener" title="Permanent link"></a></h2>
<p>Use the listener’s <a href="/api/couchbase-lite-ee/kotbase/-u-r-l-endpoint-listener/status.html"><code>status</code></a> property to get
counts of total and active connections — see <a href="#example-14">Example 14</a>.</p>
<p>You should note that these counts can be extremely volatile. So, the actual number of active connections may have
changed, by the time the <a href="/api/couchbase-lite-ee/kotbase/-connection-status/"><code>ConnectionStatus</code></a> class returns a
result.</p>
<div class="admonition example">
<p class="admonition-title"><span id='example-14'>Example 14. Get connection counts</span></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">connectionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="na">status</span><span class="o">?.</span><span class="na">connectionCount</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kd">val</span><span class="w"> </span><span class="nv">activeConnectionCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="na">status</span><span class="o">?.</span><span class="na">activeConnectionCount</span>
</span></code></pre></div>
</div>
<h2 id="stop-listener">Stop Listener<a class="headerlink" href="#stop-listener" title="Permanent link"></a></h2>
<p>It is best practice to check the status of the listener’s connections and stop only when you have confirmed that there
are no active connections — see <a href="#example-15">Example 15</a>.</p>
<div class="admonition example">
<p class="admonition-title"><span id='example-15'>Example 15. Stop listener using stop method</span></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">listener</span><span class="p">.</span><span class="na">stop</span><span class="p">()</span>
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Closing the database will also close the listener.</p>
</div>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../peer-to-peer-sync/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Peer-to-Peer Sync">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Peer-to-Peer Sync
              </div>
            </div>
          </a>
        
        
          
          <a href="../active-peer/" class="md-footer__link md-footer__link--next" aria-label="Next: Active Peer">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Active Peer
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 Jeff Lockhart
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/jeffdgr8" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/jeffdgr8" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/lockhartjeff/" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.tabs.link", "navigation.footer", "navigation.instant", "navigation.tabs", "navigation.top", "navigation.tracking", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "current", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
    
  </body>
</html>